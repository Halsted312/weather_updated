# Kalshi Temperature Trading System

## Project Overview

An advanced algorithmic trading system for Kalshi prediction markets that specializes in temperature bracket markets (e.g., "Highest temperature in Miami today"). The system combines real-time weather data, order book microstructure analysis, and cross-bracket momentum detection to predict and trade on temperature outcomes before the broader market reacts.

### Core Innovation

This system implements a **cross-bracket microstructure-aware nowcasting** strategy that:
- Detects early acceleration in one temperature bracket relative to deceleration in adjacent brackets
- Integrates 5-minute resolution weather data from Visual Crossing with market signals
- Uses Bayesian fusion to combine weather models with market microstructure
- Executes via maker orders (zero fees) with selective taker aggression when edge exceeds costs

### Expected Performance

Based on research and backtesting of similar strategies:
- **Sharpe Ratio**: 1.0-2.0 (after transaction costs)
- **Win Rate**: 55-65% on signals with >30% confidence
- **Annual Return**: 20-50% on deployed capital
- **Maximum Drawdown**: 10-20%
- **Capital Capacity**: $25K-$100K per city market
- **Trade Frequency**: 10-30 trades per day across all brackets

## System Architecture

```
┌─────────────────────────────────────────┐
│         DATA INGESTION LAYER            │
│  (Kalshi WebSocket + Visual Crossing)   │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│         FEATURE ENGINEERING             │
│  (Order Book + Weather + Cross-Bracket) │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│         PREDICTION MODELS               │
│  (VARX + Monte Carlo + Hawkes Process)  │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│         SIGNAL GENERATION               │
│  (Bayesian Fusion + Coherence Check)    │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│         EXECUTION ENGINE                │
│  (Maker-First + Inventory Management)   │
└─────────────────────────────────────────┘
```

## Key Components

### 1. Data Feeds
- **Kalshi WebSocket**: Real-time order book snapshots and deltas for all temperature brackets
- **Visual Crossing API**: 5-minute resolution temperature data with sub-hourly forecasts
- **Market Data Storage**: TimescaleDB for time-series order book and trade data

### 2. Microstructure Features
- Order book imbalance at multiple depth levels
- Weighted mid-price velocity and acceleration
- Hawkes process intensity for aggressive order flow
- Queue position value and churn rates
- Cross-bracket correlation matrices

### 3. Weather Integration
- Monte Carlo simulation of rest-of-day temperature paths
- Hazard function for probability of new high in next 5-15 minutes
- Diurnal temperature patterns by city and season
- Calibrated bracket probability distributions

### 4. Signal Logic
The system triggers when three conditions align:
1. **Acceleration Spread**: Target bracket accelerating while neighbors decelerate
2. **Order Flow Confirmation**: Aggressive buying in target bracket
3. **Hazard Gate**: High probability of temperature change based on time of day

### 5. Risk Management
- Fractional Kelly sizing (0.25-0.5x)
- Per-bracket exposure limits (10% of capital)
- Per-city concentration limits (40% of capital)
- Automated drawdown controls (halt at 15% DD)
- Dynamic position reduction during adverse moves

## Technology Stack

### Core Infrastructure
- **Language**: Python 3.10+
- **Database**: TimescaleDB (PostgreSQL extension)
- **Message Queue**: Redis for inter-process communication
- **Container**: Docker Compose for deployment

### Libraries
- **Trading**: `ccxt` (order management), `websocket-client` (real-time data)
- **Scientific**: `numpy`, `pandas`, `scipy` (statistics and optimization)
- **ML/Stats**: `scikit-learn`, `statsmodels`, `pymc3` (Bayesian modeling)
- **Visualization**: `plotly`, `streamlit` (monitoring dashboard)

### APIs
- **Kalshi**: WebSocket for market data, REST for order execution
- **Visual Crossing**: REST API for weather data (5-minute updates)

## Mathematical Models

### 1. VARX State-Space Model
```
m_{t+Δ} = A·m_t + B·ḋm_t + C·z_t + u_t
```
Where m is the vector of mid-prices, z are exogenous features

### 2. Dirichlet-Multinomial Fusion
```
α^post = w_mkt(t)·α^mkt + w_wx(t)·α^wx
p_t = E[Dir(α^post)]
```
Ensures bracket probabilities sum to 1 while weighting sources

### 3. Hawkes Process for Order Flow
```
λ(t) = μ + Σ φ(t-t_i)
```
Models self-exciting nature of aggressive order arrivals

### 4. Order Book Imbalance Signal
```
OBI = (BidVolume - AskVolume) / (BidVolume + AskVolume)
```
Calculated at top 5-10 price levels

## Performance Metrics

### Primary KPIs
- **Signal Accuracy**: Percentage of correct direction predictions
- **Execution Quality**: Realized spread vs quoted spread
- **Risk-Adjusted Return**: Sharpe and Sortino ratios
- **Market Impact**: Price movement caused by our orders

### Secondary Metrics
- **Fill Rate**: Maker orders filled vs posted
- **Adverse Selection**: Post-fill price movement
- **Inventory Turnover**: Average holding period
- **Cross-Bracket Correlation**: Hedge effectiveness

## Deployment Phases

1. **Foundation** (Weeks 1-2): Core infrastructure and data collection
2. **Models** (Weeks 3-4): Implement prediction algorithms
3. **Signals** (Weeks 5-6): Combine models and generate trading signals
4. **Paper Trading** (Weeks 7-8): Test with simulated execution
5. **Live Trading** (Weeks 9+): Gradual capital deployment

## Risk Factors

### Market Risks
- **Liquidity**: Thin order books in smaller cities
- **Resolution**: Disputes over temperature measurement
- **Competition**: Other algorithms detecting same patterns

### Technical Risks
- **Latency**: WebSocket delays or disconnections
- **Data Quality**: Missing or incorrect weather updates
- **Model Drift**: Changing market dynamics over time

### Regulatory Risks
- **Platform**: Kalshi operating restrictions by state
- **Compliance**: Position limits and reporting requirements

## Success Criteria

### Go-Live Requirements
- [ ] 30+ days of clean data collection
- [ ] Backtest Sharpe > 1.0 on out-of-sample data
- [ ] Paper trading win rate > 55%
- [ ] Maximum drawdown < 15% in all scenarios
- [ ] 99%+ system uptime over 7 days

### Ongoing Monitoring
- Daily P&L attribution by signal source
- Weekly model performance review
- Monthly strategy correlation analysis
- Quarterly full system audit

## References

### Academic Papers
- "Deep Hawkes Process for High-Frequency Market Making" (2024)
- "Application of the Kelly Criterion to Prediction Markets" (2024)
- "A Survey of Methods for Time Series Change Point Detection" (2017)

### Technical Documentation
- [Kalshi WebSocket API](https://docs.kalshi.com/websockets/orderbook-updates)
- [Visual Crossing Sub-Hourly Data](https://www.visualcrossing.com/resources/documentation/weather-api/)
- [TimescaleDB Hypertables](https://docs.timescale.com/use-timescale/latest/hypertables/)

### Industry Resources
- CFTC regulations on prediction markets
- Market microstructure best practices
- Risk management for binary options

## Contact & Support

- **Project Lead**: Stephen (FP&A at Zillow, pro se litigant, ML enthusiast)
- **Hardware**: RTX 3090 GPU, high-speed internet, Ubuntu Linux
- **Location**: Chicago, Illinois

## License

Proprietary - All rights reserved
