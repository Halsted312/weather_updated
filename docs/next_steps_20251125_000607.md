# Run summary (2025-11-25 00:06:07)

## What we did
- Backfilled hazard_mc + pmf_fusion for all cities across their available windows (used `scripts/hazard_mc.py backfill` then `scripts/pmf_fusion.py backfill`).
- Fitted MC params for all cities (`scripts/hazard_mc.py fit-params ...`), unblocking backfill errors about missing params.
- Verified coverage on `feat.minute_panel_full` (query in session): all cities now have `p_wx` and `p_fused_norm` populated through their full ingested ranges (see table below).
- Kept strategy/tuner code as-is; no logic changes this session.

## Coverage snapshot (feat.minute_panel_full)
| city | min_date | max_date | min_p_wx | max_p_wx | min_p_fused | max_p_fused |
| --- | --- | --- | --- | --- | --- | --- |
| chicago | 2024-01-01 | 2025-11-20 | 2024-01-01 | 2025-11-20 | 2024-01-01 | 2025-11-20 |
| austin | 2024-01-07 | 2025-11-20 | 2024-01-07 | 2025-11-20 | 2024-01-07 | 2025-11-20 |
| miami | 2024-01-01 | 2025-11-19 | 2024-01-01 | 2025-11-19 | 2024-01-01 | 2025-11-19 |
| denver | 2024-11-20 | 2025-11-20 | 2024-11-20 | 2025-11-20 | 2024-11-20 | 2025-11-20 |
| philadelphia | 2024-11-20 | 2025-11-19 | 2024-11-20 | 2025-11-19 | 2024-11-20 | 2025-11-19 |

## Key code points (for orientation)
- `scripts/hazard_mc.py`: baseline scaffold; `build_baseline_from_timeline` still a stub (NotImplemented); template baseline used for backfills. Duplicate ts_utc handling added earlier (UTC normalization + de-dupe before reindex).
- `scripts/pmf_fusion.py`: backfill CLI used for all cities after MC; default alpha weights.
- `scripts/check_peak_coverage.py`: quick coverage checker if you want a per-city log.
- `scripts/peak_temp_strategy.py`: wiring fixed to pass hazard mode/high/low/exit_edge, spacing warning in `prepare_panel`; model prob fallback p_wx → p_fused_norm → mid_prob; mkt_prob configurable.
- `scripts/tune_peak_temp.py`: Optuna tuner uses validation window only; train dates held for split bookkeeping.
- `scripts/backtest_triad.py`, `scripts/eval_triad_windows.py`, `scripts/tune_triad.py`: triad backtest/tuning utilities; no changes this run.

## Next steps
1) Tuning/eval (now unblocked by coverage):
   - Run `scripts/tune_peak_temp.py` on chosen train/val split (e.g., 2024 train/val for Chicago; adjust per city’s min_date).
   - Freeze best params; run `scripts/peak_temp_strategy.py` on held-out 2025 window + rolling 7-day eval.
2) Optional: add run-level logging of model-prob usage (p_wx vs p_fused_norm vs mid_prob) and per-market spacing diagnostics in `scripts/peak_temp_strategy.py`.
3) Decide if denver/philadelphia need earlier historical data (their ingested panels start 2024-11-20); if not, current coverage is aligned.
4) If desired, implement `build_baseline_from_timeline` in `scripts/hazard_mc.py` for higher-fidelity baselines; current runs use template fallback.

## Open questions for next session
- Confirm target train/val/test splits per city now that coverage is full.
- Whether to add per-event cap / additional stop conditions that were discussed earlier for peak strategy.
