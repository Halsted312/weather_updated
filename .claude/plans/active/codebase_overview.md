# Codebase Overview â€” Weather Edge Trading on Kalshi

- **Purpose**: Full research + trading stack for Kalshi weather high-temp brackets (6 bins per city/day). Ingests multi-source weather + market data, builds ML features, trains ordinal CatBoost delta models with Optuna, and powers strategy backtests and live/manual trading.
- **Data & Storage**: SQLAlchemy models under `src/db/` (weather obs/forecasts, settlement, Kalshi markets/candles, simulation tables). Visual Crossing (obs, current + historical forecasts), NOAA/IEM/NCEI settlement data, Kalshi REST/WS market data.
- **Ingestion**: Scripts in `scripts/` and `legacy/` for Visual Crossing backfills (obs/forecast snapshots/historical), settlement consolidation, Kalshi market/candle backfills, WS recorders, and ops utilities. Alembic migrations manage schema.
- **Modeling & Features**: Dataset builders in `models.data` / `models/data/dataset.py` generate per-city snapshots with market, meteo, NOAA guidance, multi-horizon, station-city aggregates, etc. Splitting helpers in `models/data/splits.py`. Caching via `models/saved/{city}/train_data_full.parquet` + `test_data_full.parquet`.
- **Training**: Primary script `scripts/train_city_ordinal_optuna.py` builds/loads datasets (supports date filters, caching), does 80/20 day-based split, Optuna-tunes ordinal CatBoost delta model, logs metrics, and saves models/params/metrics to `models/saved/{city}`. Pipeline wrapper `models/pipeline/03_train_ordinal.py` ensures splits or auto-splits `full.parquet` then calls the trainer.
- **Strategies & Trading**: `open_maker/` orchestrates backtests (strategies like base/next_over/curve_gap), utilities for bracket mapping/fees/liquidity realism, Optuna tuner for strategy params, live trader and manual trade CLI tied to Kalshi REST/WS. Backtests/trades recorded to `sim` tables and logs under `logs/`.
- **Docs & Logs**: README gives the conceptual architecture and data/strategy descriptions. Numerous logs in `logs/` capture pipeline runs and training sessions; use them to audit coverage, errors, and performance.
